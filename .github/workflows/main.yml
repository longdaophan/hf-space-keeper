name: Keep HF Space Alive
on:
  schedule:
    # Ch·∫°y 1 l·∫ßn/ng√†y v√†o l√∫c 1h UTC (8h s√°ng gi·ªù Vi·ªát Nam)
    - cron: '0 1 * * *'
  workflow_dispatch:  # Cho ph√©p ch·∫°y th·ªß c√¥ng
jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Random delay trong khung gi·ªù 8h-14h
        run: |
          # T√≠nh s·ªë gi√¢y t·ª´ 0-6 gi·ªù (8h VN - 14h VN = 6 ti·∫øng = 21600 gi√¢y)
          RANDOM_DELAY=$((RANDOM % 21600))
          echo "‚è∞ ƒê·ª£i $RANDOM_DELAY gi√¢y tr∆∞·ªõc khi ping..."
          echo "‚è∞ T∆∞∆°ng ƒë∆∞∆°ng $(($RANDOM_DELAY / 3600)) gi·ªù $(($RANDOM_DELAY % 3600 / 60)) ph√∫t"
          sleep $RANDOM_DELAY
      
      - name: Ping Hugging Face Space
        run: |
          echo "üöÄ B·∫Øt ƒë·∫ßu ƒë√°nh th·ª©c Space..."
          response=$(curl -s -o /dev/null -w "%{http_code}" \
                     -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36" \
                     -H "Accept: text/html,application/xhtml+xml" \
                     -H "Accept-Language: vi-VN,vi;q=0.9,en;q=0.8" \
                     --max-time 60 \
                     --retry 2 \
                     https://rick-d-khoa-luan.hf.space)
          
          echo "üì° Response code: $response"
          
          if [ $response -eq 200 ]; then
            echo "‚úÖ Space ƒë√£ t·ªânh v√† ƒëang ch·∫°y!"
          elif [ $response -eq 502 ] || [ $response -eq 503 ]; then
            echo "‚è≥ Space ƒëang kh·ªüi ƒë·ªông (502/503)..."
            echo "üîÑ ƒê·ª£i 30 gi√¢y r·ªìi th·ª≠ l·∫°i..."
            sleep 30
            response2=$(curl -s -o /dev/null -w "%{http_code}" \
                       -A "Mozilla/5.0" \
                       --max-time 60 \
                       https://rick-d-khoa-luan.hf.space)
            echo "üì° Response code l·∫ßn 2: $response2"
            if [ $response2 -eq 200 ]; then
              echo "‚úÖ Space ƒë√£ t·ªânh th√†nh c√¥ng!"
            else
              echo "‚ö†Ô∏è Space v·∫´n ƒëang kh·ªüi ƒë·ªông, c·∫ßn th√™m th·ªùi gian"
            fi
          else
            echo "‚ö†Ô∏è Space tr·∫£ v·ªÅ m√£ $response"
          fi
        continue-on-error: true
      
      - name: Th√¥ng b√°o ho√†n th√†nh
        run: |
          echo "‚ú® Ho√†n th√†nh ping v√†o $(date '+%Y-%m-%d %H:%M:%S UTC')"
          echo "üáªüá≥ T∆∞∆°ng ƒë∆∞∆°ng $(TZ='Asia/Ho_Chi_Minh' date '+%Y-%m-%d %H:%M:%S') gi·ªù Vi·ªát Nam"
